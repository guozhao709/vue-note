# 自定义指令

自定义指令是 Vue 框架提供的扩展模板语法、封装可复用 DOM 底层操作的核心特性，本质是一套能直接作用于 DOM 元素（或组件根元素）的 “行为增强工具”—— 它允许开发者在不编写组件的情况下，为元素注入统一的交互逻辑、样式控制或生命周期钩子，弥补了组件侧重 UI 封装、难以直接操作 DOM 底层的场景缺口。

我们常用的一些组件标签中, 经常通过自定义指令修改样式等。

一般来说, 在vue中, 一般不在js中获取dom元素, 而是在template中通过指令来操作dom元素, 指令提供了一个好的方案。

示例:

添加类名到 dom 元素中

```vue
<template>
    <p v-highlight>This sentence is important!</p>
</template>
<script setup>
// 在模板中启用 v-highlight
const vHighlight = {
    mounted: (el) => {
        el.classList.add("is-highlight");
    },
};
</script>
```

全局注册

```js
cosnt app = createApp(App)
app.directive('highlight', {...})
```

## 自定义指令使用的时机

当所需功能只能通过直接的 DOM 操作来实现时，才应该考虑使用自定义指令。

## 指令钩子

```js
const myDirective = {
    // 在绑定元素的 attribute 前
    // 或事件监听器应用前调用
    created(el, binding, vnode) {},
    // 在元素被插入到 DOM 前调用
    beforeMount(el, binding, vnode) {},
    // 在绑定元素的父组件
    // 及他自己的所有子节点都挂载完成后调用
    mounted(el, binding, vnode) {},
    // 绑定元素的父组件更新前调用
    beforeUpdate(el, binding, vnode, prevVnode) {},
    // 在绑定元素的父组件
    // 及他自己的所有子节点都更新后调用
    updated(el, binding, vnode, prevVnode) {},
    // 绑定元素的父组件卸载前调用
    beforeUnmount(el, binding, vnode) {},
    // 绑定元素的父组件卸载后调用
    unmounted(el, binding, vnode) {},
};
```

### 钩子参数

-   el：指令绑定到的元素。这可以用于直接操作 DOM。

-   binding：一个对象，包含以下属性。

    -   value：传递给指令的值。例如在 v-my-directive="1 + 1" 中，值是 2, 值也可以是一个对象的字面量。

    -   oldValue：之前的值，仅在 beforeUpdate 和 updated 中可用。无论值是否更改，它都可用。

    -   arg：传递给指令的参数 (如果有的话)。例如在 v-my-directive:foo 中，参数是 "foo"。

    -   modifiers：一个包含修饰符的对象 (如果有的话)。例如在 v-my-directive.foo.bar 中，修饰符对象是 { foo: true, bar: true }。

    -   instance：使用该指令的组件实例。

    -   dir：指令的定义对象。

冒号后面是参数, 打点后面是修饰符, 等号后面是 value.

-   vnode：代表绑定元素的底层 VNode。

-   prevVnode：代表之前的渲染中指令所绑定元素的 VNode。仅在 beforeUpdate 和 updated 钩子中可用。

## 简化形式

```vue
<template>
    <div v-color="color"></div>
</template>
```

```js
app.directive("color", (el, binding) => {
    el.style.color = binding.value;
});
```
