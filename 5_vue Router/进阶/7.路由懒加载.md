# 路由懒加载

打包成 js 时, 如果使用静态导入, 则会导致所有路由都被打包进同一个 js 文件中, 导致文件体积过大. 因此, 将对应的组件分割成不同的代码块, 当访问对应路由时再加载

使用动态导入:

```javascript
const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: "/",
      name: "Home",
      component: () => import("@/views/Home.vue"), // 动态导入组件, 只要返回一个promise
    },
  ],
});
```

注: 不要在路由中使用异步组件。异步组件仍然可以在路由组件中使用，但路由组件本身就是动态导入的。

简单介绍异步组件, 异步组件一般会通过某个条件来进行渲染(默认隐藏), 这时, 为了减小首屏的加载开销, 使用它

```javascript
import { defineAsyncComponent } from "vue";

const AsyncComment = defineAsyncComponent({
  loader: () => import("./Comment.vue"), // 核心：按需加载
  loadingComponent: () => import("./Loading.vue"), // 加载中显示
  errorComponent: () => import("./Error.vue"), // 加载失败显示
  timeout: 3000, // 3秒加载超时算失败
});
```

# 把组件按组分块

## webpack

```js
const UserDetails = () =>
  import(/* webpackChunkName: "group-user" */ "./UserDetails.vue");
const UserDashboard = () =>
  import(/* webpackChunkName: "group-user" */ "./UserDashboard.vue");
const UserProfileEdit = () =>
  import(/* webpackChunkName: "group-user" */ "./UserProfileEdit.vue");
```

## vite

```js
export default defineConfig({
  build: {
    rollupOptions: {
      // https://rollupjs.org/guide/en/#outputmanualchunks
      output: {
        manualChunks: {
          "group-user": [
            "./src/UserDetails",
            "./src/UserDashboard",
            "./src/UserProfileEdit",
          ],
        },
      },
    },
  },
});
```
