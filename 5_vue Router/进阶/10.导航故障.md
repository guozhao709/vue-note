# 等待导航结果

我们有时候在 router.push()之后，需要做一些事情, 但 push() 是异步的, 所以我们需要等待导航结果。

```javascript
async () => {
  await router.push("/home");
  // 做一些事情
};
```

# 检测导航故障

可以根据 await 返回的 promise 的解析值来判断导航是否成功。

如果值是一个 falsy, 通常是 undefined

```javascript
const navigationResult = await router.push("/my-profile");

if (navigationResult) {
  // 导航被阻止
} else {
  // 导航成功 (包括重新导航的情况)
  this.isMenuOpen = false;
}
```

给用户提示信息, 用 isNavigationFailure 函数

```javascript
import { NavigationFailureType, isNavigationFailure } from "vue-router";

// 试图离开未保存的编辑文本界面
const failure = await router.push("/articles/2");

if (isNavigationFailure(failure, NavigationFailureType.aborted)) {
  // 给用户显示一个小通知
  showToast("You have unsaved changes, discard and leave anyway?");
}
```

NavigationFailureType.aborted 的作用是打断路由的跳转, 作为第二参数, 表示要匹配的导航故障类型。

## 全局导航故障

使用导航守卫

```javascript
router.affterEach((to, from, failure) => {
  if (failure) {
    sendToAnalytics(to, from, failure);
  }
});
```

## 鉴别导航故障

即 NavigationFailureType 枚举中定义的各种导航故障类型。

1. aborted: 导航被中断, 如在导航守卫中 return false
2. cancelled: 在当前导航之前又有一个新的导航, 如在等待导航守卫中又调用了 router.push()
3. duplicated: 导航的目标与当前路由一致, 被阻止

## 导航故障的属性

```javascript
// 正在尝试访问 admin 页面
router.push("/admin").then((failure) => {
  if (isNavigationFailure(failure, NavigationFailureType.aborted)) {
    failure.to.path; // '/admin'
    failure.from.path; // '/'
  }
});
```

## 检测重定向

导航守卫返回导航时, 会覆盖之前的导航

重定向不会阻止导航, 而是创建一个新的导航, 所以要根据路径进行检查

```javascript
await router.push("/my-profile");
if (router.currentRoute.value.redirectedFrom) {
  // redirectedFrom 是解析出的路由地址，就像导航守卫中的 to和 from
}
```
